<!doctype html>
<html>
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta charset="utf-8" />
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport" />
    <meta content="GoCD is open source continuous delivery software. Learn how to cloning templates in GoCD using a script that interacts with GoCD's Configuration API." name="description" />
    <meta content="GoCD, continuous delivery, continuous delivery software, continuous integration, continuous integration software, go, goforcd, open source, template, cloning" name="keywords" />
    <title>Cloning Templates | GoCD Blog</title>
    <link href="../../../../assets/images/favicon.ico" rel="shortcut icon" />
    <link href="../../../../assets/stylesheets/site.css" rel="stylesheet" />
    <script src="../../../../assets/javascripts/all.js"></script>
    <link rel="alternate" type="application/atom+xml" title="GoCD blog feed" href="../../../../feed.xml" />
  </head>

  <body class="x2014 x2014_08 x2014_08_19 x2014_08_19_cloning-templates x2014_08_19_cloning-templates_index">
    <header class="top">
  <div class="container">
    <a class="logo" href="../../../../"><img title="GoCD Logo" alt="GoCD Logo" src="../../../../assets/images/go_logo.svg" /></a>
    <nav class="mainnav">
      <ul class="level0">
        <li class="dropdown">
          <a class="link_whygocd" href="../../../../why-gocd/">Why GoCD?</a>
        </li>
        <li class="dropdown">
          <a class="toplink_contribute" href="../../../../contribute/">Community</a>
          <ul  class="level1">
            <li><a class="link_contribute" href="../../../../contribute/">Contribute</a></li>
            <li><a class="link_events" href="../../../../events/">Events</a></li>
            <li><a class="link_plugins" href="../../../../plugins/">Plugins</a></li>
          </ul>
        </li>
        <li><a class="link_blog" href="../../../../blog/">Blog</a></li>
        <li class="dropdown">
          <a class="toplink_help" href="../../../../help/">Help</a>
          <ul  class="level1">
            <li><a class="getting-started" href="../../../../help/">Getting started</a></li>
            <li><a target="_blank" href="https://docs.go.cd/current/">Documentation</a></li>
            <li><a class="link_resources" href="../../../../resources.html">Resources</a></li>
          </ul>
        </li>
        <li><a class="link_download" href="../../../../download/">Download</a></li>
      </ul>
    </nav>
    <button class="navbtn menu collapse">
    <span></span>
    </button>
  </div>
</header>
<span id="top"></span>


    <div class="container blog-post">

  <header class="blog-post-header">
    <h2>Guest post: Continuous Delivery with <span class="go">Go</span>CD - Cloning Templates</h2>
    <h4>Marius-Stefan Ciotlos</h4>
  </header>
  <div class="row">
    <div class="col-md-9">
      <main id="main" role="main">
      <p>When using GO for Continuous Delivery with multiple teams where you have various security groups, you usually end up with multiple template types. Depending on your application ecosystem you might have different deployment methods depending on the application type, that have some overlapping. At the moment we don't have the ability to have Stage templates, so you need a completely new template when you have differences.</p>

<p>We have decided to have one deployment template separate per application / security group (Pipeline group) so we distribute maintenance, but also reduce the risk of breaking Pipelines of other teams when we change a base template. Having different templates also allows us to allocate <a href="http://www.go.cd/2014/02/24/go-template-permissions.html">Template Admins</a> specific for the application / team / security group that now can manage most of the needs of a team without requiring GoCD System Admin rights.</p>

<p>As you don't want team to get Admin access across multiple applications but you still want them to have something to start with (a base template), we have created two Basic templates that cover basic needs for an application deployment that we "Clone" for each team. After cloning we assign an Admin from their team so they can start modifying it according to their own flavour. Cloning templates is not available in GO at the moment, so we had to find a way around it. 
One <a href="https://github.com/oanastoia">contributor</a> created a script that interacts with GO's own <a href="http://www.go.cd/documentation/user/current/api/configuration_api.html">Configuration API</a> to allow template cloning.</p>

<h3 id="how-to-setup-cloning-in-your-go-server-instance">How to setup cloning in your GO server instance</h3>
<ol>
  <li>Make sure you have access to <a href="https://github.com/oanastoia/go-config-management.git">https://github.com/oanastoia/go-config-management.git</a>, otherwise you will need to clone this repository inside your infrastructure</li>
  <li>Create a Pipeline in your GoCD server instance</li>
  <li>Use the "Trigger with options" button to do the magic!</li>
</ol>

<h3 id="step-by-step-setup">Step by step setup</h3>
<p>In this section I will try to cover with screenshots the steps you need to achieve the easiest to use setup</p>

<h4 id="create-a-new-template-group">Create a new template group</h4>
<p>Create a new template group for your "Administrative" tasks that you give permissions only to the persons you want to use the cloning. This will be useful if you decide to have more "configuration" type of pipelines. 
In our organisation we have a "tooling" repository we use to wrap complex scripts to use in our tasks.
I will not go into detail on how to achieve this, but you can read more on how to <a href="http://www.go.cd/documentation/user/current/configuration/dev_authorization.html#specifying-permissions-for-pipeline-groups">specify permissions for pipeline groups</a>.</p>

<h4 id="create-a-new-pipeline-within-this-group">Create a new pipeline within this group</h4>
<ol>
  <li>You will need to <a href="http://www.go.cd/documentation/user/current/configuration/quick_pipeline_setup.html">create new pipeline</a> within this group.</li>
  <li>You will need to use Git as Material Type and under the URL, use the location of the cloning script (https://github.com/oanastoia/go-config-management.git if you have access to it, or the location where you cloned it). Use "Check Connection" to test it out.</li>
  <li>You will need to add two Environment Variables: SOURCE_TEMPLATE and DESTINATION_TEMPLATE that have some default values</li>
  <li>You will need to add two Secure Environment Variables: API_USER and API_PASS that contain credentials for a user that has correct permissions to use the <a href="http://www.go.cd/documentation/user/current/api/configuration_api.html">Configuration API</a></li>
</ol>

<p><img title="Environment Variables view" alt="Environment Variables view" src="../../../../assets/images/blog/cloning-templates/environment-variable-view.png" /></p>

<p>Alternative you can use the Config XML to inject your template in the group using the code below (do not forget to replace the environment variables with the right values)</p>

<pre><code>&lt;pipeline name="GoCloneTemplate"&gt;
  &lt;environmentvariables&gt;
    &lt;variable name="SOURCE_TEMPLATE"&gt;
      &lt;value&gt;Source_Template&lt;/value&gt;
    &lt;/variable&gt;
    &lt;variable name="DESTINATION_TEMPLATE"&gt;
      &lt;value&gt;Example_Clone&lt;/value&gt;
    &lt;/variable&gt;
  &lt;/environmentvariables&gt;
  &lt;materials&gt;
    &lt;git url="https://github.com/oanastoia/go-config-management.git" /&gt;
  &lt;/materials&gt;
  &lt;stage name="CloneTemplate"&gt;
    &lt;approval type="manual" /&gt;
    &lt;jobs&gt;
      &lt;job name="clone_template"&gt;
        &lt;tasks&gt;
          &lt;exec command="ruby"&gt;
            &lt;arg&gt;TemplateClone.rb&lt;/arg&gt;
            &lt;arg&gt;clone&lt;/arg&gt;
            &lt;runif status="passed" /&gt;
          &lt;/exec&gt;
        &lt;/tasks&gt;
      &lt;/job&gt;
    &lt;/jobs&gt;
  &lt;/stage&gt;
&lt;/pipeline&gt;
</code></pre>

<p>After adding the code, please add the API_USER and API_PASS Secure Environment Variables to reflect the correct user and password as seen in the above screenshot.</p>

<h4 id="trigger-the-pipeline-with-options">Trigger the pipeline with options</h4>
<p>Now you can just trigger your pipeline with options and go to the Environment Variables tab to put in the right details for cloning.</p>

<p><img title="Trigger Pipeline with Options " alt="Trigger Pipeline with Options " src="../../../../assets/images/blog/cloning-templates/trigger-with-options-1.png" />
<img title="Environment Variables Tab" alt="Environment Variables Tab" src="../../../../assets/images/blog/cloning-templates/trigger-with-options-2.png" /></p>

<p>Enjoy!</p>

      </main>
    </div>
    <div class="col-md-3">
      <aside class="post-sidebar">
        <section  class="recent-ariticles">
          <h2 class="section-title">Recent Articles</h2>
          <ol>
            <li>
              <span class="post-date">Mar 24</span>
              <span class="post-author">David Rice</span>
              <a href="../../../../2016/03/24/how-to-avoid-brittle-code/">How to Avoid Brittle Code</a>
            </li>
            <li>
              <span class="post-date">Mar 15</span>
              <span class="post-author">David Rice</span>
              <a href="../../../../2016/03/15/are-you-ready-for-continuous-delivery-part-2-feedback-loops/">Are you ready for Continuous Delivery? Part 2: Feedback loops</a>
            </li>
            <li>
              <span class="post-date">Feb  8</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../../2016/02/08/not-done-unless-its-done-security/">Add Security Testing to Your Deployment Pipelines</a>
            </li>
            <li>
              <span class="post-date">Jan 25</span>
              <span class="post-author">David Rice and Aravind SV</span>
              <a href="../../../../2016/01/25/are-you-ready-for-continuous-delivery/">Are you ready for Continuous Delivery?</a>
            </li>
            <li>
              <span class="post-date">Jan 17</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../../2016/01/17/not-done-unless-its-done/">It's not Continuous Delivery if you can't deploy right now.</a>
            </li>
            <li>
              <span class="post-date">Dec 28</span>
              <span class="post-author">Nenad Bozic</span>
              <a href="../../../../2015/12/28/gocd-continuous-delivery-through-pipelines/">Guest post: GoCD - Continuous Delivery through pipelines</a>
            </li>
            <li>
              <span class="post-date">Dec 22</span>
              <span class="post-author">Aravind SV</span>
              <a href="../../../../2015/12/22/gocd-in-2016/">Roadmap - GoCD in 2016</a>
            </li>
            <li>
              <span class="post-date">Nov 18</span>
              <span class="post-author">Rajiesh</span>
              <a href="../../../../2015/11/18/Open-Source-Tests/">Open Source Tests - The GoCD way</a>
            </li>
            <li>
              <span class="post-date">Nov  9</span>
              <span class="post-author">GoCD Team</span>
              <a href="../../../../2015/11/09/deserialization-vulnerability-commons-collections/">Vulnerability in GoCD - Java deserialization and Apache commons-collections</a>
            </li>
            <li>
              <span class="post-date">Oct 29</span>
              <span class="post-author">Ken Mugrage</span>
              <a href="../../../../2015/10/29/go-webinar-recording/">Continuous Delivery with GoCD - Webinar Recording</a>
            </li>
          </ol>
        </section>
        <section>
          <h2 class="section-title">By Year</h2>
          <ol>
            <li><a href="../../../../2016/">2016 (5)</a></li>
            <li><a href="../../../../2015/">2015 (21)</a></li>
            <li><a href="../../../">2014 (26)</a></li>
          </ol>
        </section>
      </aside>
    </div>
  </div>

  <div class="row">
    <div class="col-md-9">
      <div id="disqus_thread"></div>
      <script>
        var disqus_config = function () {
          /* Careful: Changing the value of page.url and page.identifier might mean you lose comments. */
          this.page.url = "https://www.go.cd/2014/08/19/cloning-templates.html";
          this.page.identifier = this.page.url;
          this.shortname = 'gocdblog';
        };
        (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//gocdblog.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </div>
  </div>
</div>

<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-571784c91d5449dd"></script>

    <footer>
  <div class="join-community">
    <div class="container">
      <h3>Join our community</h3>
      <ul>
        <li>
          <a href="https://groups.google.com/forum/#!forum/go-cd" target="_blank">
            <i class="fa fa-user-plus"></i>
            join us
          </a>
        </li>
        <li>
          <a href="https://gitter.im/gocd/gocd" target="_blank">
            <i class="fa fa-wechat"></i>
            develop with us
          </a>
        </li>
        <li>
          <a href="https://github.com/gocd/gocd" target="_blank">
            <i class="fa fa-binoculars"></i>
            watch us
          </a>
        </li>
        <li>
          <a href="https://twitter.com/goforcd" target="_blank">
            <i class="fa fa-twitter"></i>
            follow us
          </a>
        </li>
      </ul>
    </div>
  </div>
  <div class="page-footer">
    <div class="container">
      <div class="foo-content">
      <div class="links">
         <a href="../../../../subscribe/">Subscribe to updates</a> 
      </div>
        <h5 class="help-us-improve">Make this place better</h5>
        <a href="https://github.com/gocd/gocd.github.io" class="social-buttons"><i class="fa fa-code-fork" aria-hidden="true"></i> fork</a>
        <a href="https://github.com/gocd/gocd.github.io/issues"  class="social-buttons"> <i class="fa fa-github" aria-hidden="true"></i> suggest</a>
        <p>
          GoCD is an open-source project, sponsored by <a target="_blank" href="http://www.thoughtworks.com">ThoughtWorks Inc.</a>
          under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank" title="Apache 2.0 License">Apache License, Version 2.0</a>

        </p>
      </div>
    </div>
  </div>
</footer>
<a href="#top" class="back-top"><i class="fa fa-arrow-circle-up"></i></a>

  </body>

  <!-- Google Tag Manager -->
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5T5PTB"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>
// <![CDATA[
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-5T5PTB');
// ]]>
</script>
<!-- End Google Tag Manager -->

<!-- Marketo -->
<script type="text/javascript">
document.write(unescape("%3Cscript src='//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>Munchkin.init('199-QDE-291');</script>
<!-- End Marketo -->

<script type="text/javascript">
// <![CDATA[
!function(){var t=window.jtr=window.jtr||[];if(!t.initialize){if(t.invoked)return void(window.console&&console.error&&console.error("Journey tracking snippet included twice."));t.invoked=!0,t.methods=["page","identify","userTraits","experimentGroup","track","trackInteraction","noConflict"],t.factory=function(e){return function(){var n=Array.prototype.slice.call(arguments);return n.unshift(e),t.push(n),t}};for(var e=0;e<t.methods.length;e++){var n=t.methods[e];t[n]=t.factory(n)}t.load=function(t){var e=document.documentElement;e.setAttribute("data-jtr-device-token",t);e.setAttribute("data-jtr-events-url", "https://event-stream.journey-app.io/events");var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src="https://cdn.journey-app.io/v1.0.3/journey-tracker.min.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(n,r)},t.load("j.eca3f1b7-dbb4-4594-bade-9a8eb66ffe2a"),t.page()}}();
// ]]>
</script>

</html>
